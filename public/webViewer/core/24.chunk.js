/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[24],{402:function(Ca,ua,r){r.r(ua);var pa=r(1),ja=r(14),ka=r(2);Ca=r(48);var fa=r(32),da=r(9);r=function(){function ba(){this.init()}ba.prototype.init=function(){this.N_=!1;this.me=this.Qj=this.connection=null;this.Jp={};this.xa=this.NB=null};ba.prototype.Qda=function(w){for(var y=this,h=0;h<w.length;++h){var e=w[h];switch(e.at){case "create":this.Jp[e.author]||(this.Jp[e.author]=e.aName);this.P6(e);break;case "modify":this.xa.Kq(e.xfdf).then(function(a){y.xa.PR(a[0])});
break;case "delete":this.xa.Kq("<delete><id>"+e.aId+"</id></delete>")}}};ba.prototype.P6=function(w){var y=this;this.xa.Kq(w.xfdf).then(function(h){h=h[0];h.authorId=w.author;y.xa.PR(h);y.xa.trigger(ja.a.UPDATE_ANNOTATION_PERMISSION,[h])})};ba.prototype.r6=function(w,y,h){this.Qj&&this.Qj(w,y,h)};ba.prototype.preloadAnnotations=function(w){this.addEventListener("webViewerServerAnnotationsEnabled",this.r6.bind(this,w,"add",{imported:!1}),{once:!0})};ba.prototype.initiateCollaboration=function(w,y,
h){var e=this;if(w){e.me=y;e.xa=h.Ga();h.addEventListener(ja.d.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.mea(w);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var b=JSON.parse(a.responseText);e.connection=exports.Na.Wea(Object(fa.h)(e.me,"blackbox/"),"annot");e.NB=b.id;e.Jp[b.id]=b.user_name;e.xa.WS(b.id);e.connection.Qka(function(n){n.t&&n.t.startsWith("a_")&&n.data&&e.Qda(n.data)},function(){e.connection.send({t:"a_retrieve",
dId:w});e.trigger(ba.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.Jp[b.id],e.NB])},function(){e.disableCollaboration()})}catch(n){Object(ka.g)(n.message)}});a.open("GET",Object(fa.h)(this.me,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();e.N_=!0;e.xa.Gba(function(b){return e.Jp[b.Author]||b.Author})}else Object(ka.g)("Document ID required for collaboration")};ba.prototype.disableCollaboration=function(){this.Qj&&(this.xa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Qj),this.Qj=
null);this.connection&&this.connection.In();this.xa&&this.xa.WS("Guest");this.init();this.trigger(ba.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ba.prototype.mea=function(w){var y=this;this.Qj&&this.xa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Qj);this.Qj=function(h,e,a){return Object(pa.b)(this,void 0,void 0,function(){var b,n,f,x,z,ha,la,aa,ca;return Object(pa.d)(this,function(ia){switch(ia.label){case 0:if(a.imported)return[2];b={t:"a_"+e,dId:w,annots:[]};return[4,y.xa.c3()];case 1:n=
ia.ea();"delete"!==e&&(f=(new DOMParser).parseFromString(n,"text/xml"),x=new XMLSerializer);for(z=0;z<h.length;z++)ha=h[z],aa=la=void 0,"add"===e?(la=f.querySelector('[name="'+ha.Id+'"]'),aa=x.serializeToString(la),ca=null,ha.InReplyTo&&(ca=y.xa.HE(ha.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:ha.Id,author:y.NB,aName:y.Jp[y.NB],parent:ca,xfdf:"<add>"+aa+"</add>"})):"modify"===e?(la=f.querySelector('[name="'+ha.Id+'"]'),aa=x.serializeToString(la),b.annots.push({at:"modify",aId:ha.Id,
xfdf:"<modify>"+aa+"</modify>"})):"delete"===e&&b.annots.push({at:"delete",aId:ha.Id});0<b.annots.length&&y.connection.send(b);return[2]}})})}.bind(y);this.xa.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.Qj)};ba.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ba}();Object(Ca.a)(r);ua["default"]=r}}]);}).call(this || window)
